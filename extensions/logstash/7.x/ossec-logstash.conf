input {
  beats {
    port => 5044  # Logstash listens on port 5044 for logs from Filebeat
  }
}

filter {
  # OSSEC Alerts Parsing
  if "ossec" in [tags] {
    grok {
      match => {
        "message" => "\*\* Alert %{NUMBER:alert_id}\.%{NUMBER:alert_sequence}: %{DATA:alert_type} - %{GREEDYDATA:alert_category},\n%{YEAR:year} %{MONTH:month} %{MONTHDAY:day} %{TIME:time} %{HOSTNAME:hostname}->%{DATA:log_file}\nRule: %{NUMBER:rule_id} \(level %{NUMBER:rule_level}\) -> '%{DATA:rule_description}'\n(?:User: %{DATA:user})?\n%{GREEDYDATA:log_message}"
      }
    }

    mutate {
      add_field => { "log_source" => "ossec" }
      add_field => { "prediction_status" => "pending" }
    }
  }

  # Syslog Parsing
  if "syslog" in [tags] {
    grok {
      match => {
        "message" => "<%{NUMBER:syslog_pri}>%{SYSLOGTIMESTAMP:syslog_timestamp} %{DATA:syslog_host} %{DATA:syslog_program}: %{GREEDYDATA:syslog_message}"
      }
    }

    mutate {
      add_field => { "log_source" => "syslog" }
      add_field => { "prediction_status" => "pending" }
    }
  }

  # Add more conditional filters for other log types if needed
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]  # Elasticsearch instance
    index => "scytheex-%{log_source}-%{+YYYY.MM.dd}"  # Dynamic index based on log source (e.g., ossec or syslog)
  }

  # Uncomment for debugging purposes if needed:
  # stdout { codec => rubydebug }
}